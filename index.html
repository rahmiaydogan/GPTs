// script.js
document.addEventListener('DOMContentLoaded', () => {
    const cardsContainer = document.getElementById('gpt-cards-container');
    const searchBar = document.getElementById('search-bar');

    // gptData'nın data.js dosyasından geldiğini varsayıyoruz
    if (typeof gptData === 'undefined' || !Array.isArray(gptData)) {
        console.error('GPT verisi bulunamadı veya hatalı formatta.');
        cardsContainer.innerHTML = "<p>GPT verileri yüklenirken bir sorun oluştu.</p>";
        return;
    }
    
    // console.log("Yüklenecek GPT Sayısı:", gptData.length); // Yüklenecek kart sayısını kontrol et

    function renderCards(dataToRender) {
        cardsContainer.innerHTML = ''; // Mevcut kartları temizle
        if (dataToRender.length === 0) {
            cardsContainer.innerHTML = '<p style="text-align:center; grid-column: 1 / -1;">Aramanızla eşleşen GPT bulunamadı.</p>';
            return;
        }

        dataToRender.forEach(gpt => {
            const card = document.createElement('div');
            card.classList.add('gpt-card');
            card.dataset.name = gpt['GPT Adı'].toLowerCase();
            card.dataset.description = gpt['Açıklama'].toLowerCase();

            const title = document.createElement('h3');
            title.textContent = gpt['GPT Adı'];

            const description = document.createElement('p');
            description.classList.add('description');
            description.textContent = gpt['Açıklama'];

            const chats = document.createElement('p');
            chats.classList.add('info');
            chats.innerHTML = `<strong>Sohbet:</strong> ${gpt['Sohbet Sayısı']}`;

            const access = document.createElement('p');
            access.classList.add('info');
            access.innerHTML = `<strong>Erişim:</strong> ${gpt['Erişim Bilgisi']}`;

            const buttonsDiv = document.createElement('div');
            buttonsDiv.classList.add('buttons');

            const copyButton = document.createElement('button');
            copyButton.classList.add('copy-btn');
            copyButton.textContent = 'Kopyala';
            copyButton.addEventListener('click', () => {
                navigator.clipboard.writeText(gpt['URL']).then(() => {
                    copyButton.textContent = 'Kopyalandı!';
                    setTimeout(() => {
                        copyButton.textContent = 'Kopyala';
                    }, 2000);
                }).catch(err => {
                    console.error('URL kopyalanamadı: ', err);
                    alert('URL kopyalanamadı. Lütfen konsolu kontrol edin.');
                });
            });

            const goButton = document.createElement('button');
            goButton.classList.add('go-btn');
            goButton.textContent = 'Git';
            goButton.addEventListener('click', () => {
                window.open(gpt['URL'], '_blank');
            });

            buttonsDiv.appendChild(copyButton);
            buttonsDiv.appendChild(goButton);

            card.appendChild(title);
            card.appendChild(description);
            card.appendChild(chats);
            card.appendChild(access);
            card.appendChild(buttonsDiv);

            cardsContainer.appendChild(card);
        });
    }

    // Arama fonksiyonu
    searchBar.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase().trim();
        const filteredData = gptData.filter(gpt => {
            const nameMatch = gpt['GPT Adı'].toLowerCase().includes(searchTerm);
            const descriptionMatch = gpt['Açıklama'].toLowerCase().includes(searchTerm);
            return nameMatch || descriptionMatch;
        });
        renderCards(filteredData);
    });

    // İlk render
    renderCards(gptData);
});
